pub mod opt_math;
pub mod wrapping_math;
pub mod hashes;
pub mod utils;
pub mod samples;

pub mod mlkem;
pub mod ntt;
pub mod zq;
pub mod constants;

use mlkem::mlkem_key_gen_512;
use mlkem::mlkem_encaps_512;
use mlkem::mlkem_decaps_512;

#[executable]
fn main(){
    // try out full mlkem512 flow
    // all random seeds are hardcoded
    test_keygen();
    test_encaps();
    test_decaps();
    println!("Finished execution");
}


fn test_keygen(){
    let keys = mlkem_key_gen_512();
    assert!(keys.ek.span() == encapsulation_key_n8.span());
    assert!(keys.dk.span() == decapsulation_key_n8.span());
    print!("MLKEM512 Key Generation complete.\n");  
    
}

fn test_encaps(){
    let keyCipher = mlkem_encaps_512(encapsulation_key_n8.span());
    assert!(keyCipher.c.span() == ciphertext_n8.span());
    assert!(keyCipher.key.span() == shared_key_n8.span());
    print!("MLKEM512 Encapsulation complete.\n");
}

fn test_decaps(){
    let recovered_key = mlkem_decaps_512(decapsulation_key_n8.span(), ciphertext_n8.span());
    assert!(recovered_key.span() == shared_key_n8.span());
    print!("MLKEM512 Decapsulation complete\n");
}

fn print_u8_array(arr: Span<u8>) -> () {
    for i in 0..arr.len() {
        // print leading zeros for single digit hex
        print!("0x");
        if *arr.at(i) < 16 {
            print!("0");
        }
        println!("{:x}", *arr.at(i));
    }
}

const ciphertext_n8 : [u8; 24] = [
    0x70,
    0x7d,
    0xf2,
    0x2b,
    0xbd,
    0x3e,
    0x96,
    0x61,
    0x39,
    0x96,
    0x36,
    0xcf,
    0x3b,
    0xeb,
    0x6d,
    0xc9,
    0x7c,
    0xbf,
    0x1e,
    0xc3,
    0xb4,
    0x52,
    0x0e,
    0x22
];

const shared_key_n8 : [u8; 32] = [
    0x7c,
    0x5b,
    0xc8,
    0x41,
    0xe6,
    0x02,
    0x15,
    0xd4,
    0x41,
    0x8f,
    0xbb,
    0xec,
    0x8f,
    0x3f,
    0x05,
    0xbf,
    0xa8,
    0x36,
    0x0d,
    0x4b,
    0xc3,
    0xbb,
    0xe1,
    0x22,
    0x63,
    0x10,
    0x98,
    0x8f,
    0x99,
    0xe1,
    0xdd,
    0x32
];

const decapsulation_key_n8 : [u8; 144] = [
    0x2e,
    0x49,
    0x9c,
    0x54,
    0xd3,
    0x33,
    0xea,
    0xf6,
    0x6f,
    0x9a,
    0x26,
    0x60,
    0x54,
    0x09,
    0xd0,
    0x2a,
    0x03,
    0xd0,
    0xd5,
    0x09,
    0xd0,
    0xab,
    0x03,
    0xd0,
    0x43,
    0x48,
    0xbb,
    0xcb,
    0x79,
    0xc3,
    0x44,
    0xc5,
    0xce,
    0xf5,
    0x62,
    0x41,
    0x42,
    0xa8,
    0x9d,
    0x0f,
    0x12,
    0x9e,
    0xc6,
    0x55,
    0x1b,
    0x94,
    0xe7,
    0x52,
    0xb1,
    0x72,
    0x0e,
    0x4e,
    0xd5,
    0xac,
    0x0a,
    0xdd,
    0x45,
    0x7f,
    0x57,
    0x3a,
    0x04,
    0x14,
    0x65,
    0xbc,
    0xbd,
    0x7c,
    0xa4,
    0xe1,
    0xd7,
    0xd5,
    0x3e,
    0xaa,
    0xde,
    0xda,
    0x51,
    0x19,
    0x62,
    0xa3,
    0x6e,
    0xb0,
    0x9a,
    0xe1,
    0x1f,
    0x2a,
    0x7e,
    0x62,
    0xb1,
    0xbc,
    0xcb,
    0x0f,
    0xd0,
    0x8c,
    0x95,
    0x16,
    0xc6,
    0x4c,
    0x9f,
    0x6b,
    0xe0,
    0xe5,
    0xb8,
    0x6d,
    0x6f,
    0xb4,
    0x45,
    0xd6,
    0x55,
    0x9d,
    0x9a,
    0x99,
    0xae,
    0x2a,
    0xc6,
    0xf5,
    0x78,
    0x5a,
    0x6f,
    0x2b,
    0x42,
    0xe8,
    0x43,
    0x22,
    0x8b,
    0xe5,
    0x3e,
    0xb7,
    0x68,
    0xd6,
    0x4c,
    0x6f,
    0x9d,
    0x43,
    0x55,
    0xae,
    0x95,
    0xf0,
    0x83,
    0xe5,
    0x1e,
    0xd5,
    0x7c,
    0x43,
    0x73,
    0x10
];

const encapsulation_key_n8 : [u8; 56] = [
    0x43,
    0x48,
    0xbb,
    0xcb,
    0x79,
    0xc3,
    0x44,
    0xc5,
    0xce,
    0xf5,
    0x62,
    0x41,
    0x42,
    0xa8,
    0x9d,
    0x0f,
    0x12,
    0x9e,
    0xc6,
    0x55,
    0x1b,
    0x94,
    0xe7,
    0x52,
    0xb1,
    0x72,
    0x0e,
    0x4e,
    0xd5,
    0xac,
    0x0a,
    0xdd,
    0x45,
    0x7f,
    0x57,
    0x3a,
    0x04,
    0x14,
    0x65,
    0xbc,
    0xbd,
    0x7c,
    0xa4,
    0xe1,
    0xd7,
    0xd5,
    0x3e,
    0xaa,
    0xde,
    0xda,
    0x51,
    0x19,
    0x62,
    0xa3,
    0x6e,
    0xb0
];